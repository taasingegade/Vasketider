<!DOCTYPE html>
<html>
<head>
<link rel="icon" type="image/x-icon" href="{{ url_for('static', filename='favicon.ico') }}">
    <title>Vasketider</title>
<link rel="manifest" href="/static/manifest.json">
<link rel="stylesheet" href="/static/style.css">
    <script>
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('/static/service-worker.js');
        }
    </script>
</head>
<body>
    <div class="toppanel">
        <form method="post" action="/logout">
            <button class="toppanel-knap">Log ud</button>
        </form>
        <form method="get" action="/kommentar">
            <button class="toppanel-knap">Kommentar</button>
        </form>
        <form method="get" action="/dokumenter">
            <button class="toppanel-knap">Dokumenter</button>
        </form>
<form method="get" action="/profil">
    <button class="toppanel-knap">Min profil</button>
</form>
<form method="get" action="/regler">
  <button class="toppanel-knap">Regler</button>
</form>
<div class="status">
    <span class="status-label">üß∫ Status:</span>
    <span class="status-value">{{ miele_status | capitalize }}</span>
    </div>
        <form method="get" action="/index" style="margin-left:auto; display:flex; gap:10px;">
            <button class="toppanel-knap" type="submit" name="uge" value="{{ valgt_uge - 1 }}">‚óÄ</button>
            <span style="color:white; align-self: center;">Uge {{ valgt_uge }}</span>
            <button class="toppanel-knap" type="submit" name="uge" value="{{ valgt_uge + 1 }}">‚ñ∂</button>
        </form>
  </div>
    </div>

    <div class="wrapper">
 <banner><h2>Vasketider for T√•singegade 16 ‚Äì Uge {{ valgt_uge }}</h2></banner>

    <div class="main">
        
{% if request.args.get("besked") %}
<div id="popup-besked" style="position: relative; padding: 10px; background-color: rgba(0, 150, 0, 0.7); color: white; border-radius: 8px; font-weight: bold; margin-top: 10px; max-width: 300px;">
    {{ request.args.get("besked") }}
</div>
{% endif %}

{% if request.args.get("fejl") %}
<div id="popup-fejl" style="position: relative; padding: 10px; background-color: rgba(200, 0, 0, 0.8); color: white; border-radius: 8px; font-weight: bold; margin-top: 10px; max-width: 300px;">
    {{ request.args.get("fejl") }}
</div>
{% endif %}
       <div class="calendar">
  <div></div>
 {% for dag in ugedage_dk %}
  {% set dato = ugedage_dato[loop.index0] %}
  <div style="text-align: center;">
    <strong>{{ dag }}</strong><br>d. {{ dato.day }}/{{ dato.month }}
  </div>
{% endfor %}

  {% for i in range(4) %}
    <div><strong>{{ tider[i] }}</strong></div>
    {% for j in range(7) %}
      {% set dato = ugedage_dato[j] %}
      {% set booking = bookinger.get((dato, i)) %}

     {% if booking %}
  <div style="display: flex; justify-content: center; align-items: center;">
    {% if booking == 'service' %}
      <button class="slot-btn" style="background-color: gold; color: black;">{{ booking }}</button>
    {% elif booking == bruger %}
      <form method="POST" action="/slet">
        <!-- Dato sendes altid som YYYY-MM-DD -->
        <input type="hidden" name="dato" value="{{ dato.isoformat() }}">
        <input type="hidden" name="tid" value="{{ i }}">
        <input type="hidden" name="valgt_uge" value="{{ valgt_uge }}">
        <button type="submit" class="slot-btn" style="background-color: crimson;">{{ booking }}</button>
      </form>
    {% else %}
      <button class="slot-btn" style="background-color: crimson;" disabled>{{ booking }}</button>
    {% endif %}
  </div>
{% else %}
  <div style="display: flex; justify-content: center; align-items: center;">
    <form method="POST" action="/book">
      <!-- Dato sendes altid som YYYY-MM-DD -->
      <input type="hidden" name="dato" value="{{ dato.isoformat() }}">
      <input type="hidden" name="tid" value="{{ i }}">
      <input type="hidden" name="valgt_uge" value="{{ valgt_uge }}">
      <button type="submit" class="slot-btn ledig-knap">Ledig</button>
    </form>
  </div>
{% endif %}
    {% endfor %}
  {% endfor %}
</div>

        <hr>
        <h3>Alle bookede tider (n√¶ste 14 dage):</h3>
<ul>
{% if kommende_bookinger %}
    {% for b in kommende_bookinger %}
        <li><strong>{{ b.dato_dk }}</strong> ‚Äì <strong>{{ b.slot_tekst }}</strong> ‚Üí {{ b.brugernavn }}</li>
    {% endfor %}
{% else %}
    <li>Ingen bookede tider de n√¶ste 14 dage.</li>
{% endif %}
</ul>        </div>
    </div>
</div>
</div>
<script>
function hentBookinger() {
    fetch('/bookinger_json')
      .then(res => {
        if (!res.ok) throw new Error("Netv√¶rksfejl: " + res.status);
        return res.json();
      })
      .then(data => {
        console.log("Hentede bookinger:", data); // ‚Üê LOG VISNING

        let ul = document.getElementById('bookinger_14_ul');
        if (!ul) return;
        ul.innerHTML = "";
        if(data.length === 0) {
            ul.innerHTML = "<li>Ingen bookede tider de n√¶ste 14 dage.</li>";
        } else {
            data.forEach(function(item) {
                ul.innerHTML += `<li><strong>${item.dato}</strong> ‚Äì <strong>${item.tid}</strong> ‚Üí ${item.navn}</li>`;
            });
        }
      })
      .catch(error => {
        console.error("Fejl ved hentning af bookinger:", error); // ‚Üê FEJL LOG
      });
}
setInterval(hentBookinger, 10000); // Hver 10. sekund
window.onload = hentBookinger;
</script>
<script>
window.onload = function() {
    hentBookinger();

    const popup = document.getElementById('popup-besked');
    if (popup) {
        setTimeout(() => {
            popup.style.display = 'none';
        }, 3000); // 3 sekunder
    }
}
</script>
<footer>¬© Hornsberg Group</footer>
</body>
</html>