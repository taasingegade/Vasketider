<!DOCTYPE html>
<html lang="da">
<head>
  <meta charset="UTF-8">
  <title>Login</title>
  <link rel="icon" type="image/x-icon" href="{{ url_for('static', filename='favicon.ico') }}">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="manifest" href="{{ url_for('static', filename='manifest.json') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
  <script>
    // Service Worker
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('{{ url_for("static", filename="service-worker.js") }}');
    }

    // UI helpers
    function submitLoginForm(){
      const f = document.getElementById('loginForm');
      if (f) f.submit();
    }
    function toggleMenu(){
      const m = document.querySelector('.login-menu');
      if (m) m.classList.toggle('show');
    }

    // Luk menu ved klik udenfor
    document.addEventListener('click', (e)=>{
      const menu = document.querySelector('.login-menu');
      const btn  = document.querySelector('.hamburger');
      if (!menu || !btn) return;
      const outside = !menu.contains(e.target) && !btn.contains(e.target);
      if (outside) menu.classList.remove('show');
    });

    // Remember me + Enter-submit
    document.addEventListener('DOMContentLoaded', ()=>{
      const form = document.getElementById('loginForm');
      const u = document.getElementById('brugernavn');
      const p = document.getElementById('kode');
      const chk = document.getElementById('huskMig');

      // Enter tryk sender formularen
      form.addEventListener('keydown', (ev)=>{
        if (ev.key === 'Enter') { ev.preventDefault(); form.submit(); }
      });

      // Indlæs fra localStorage
      const su = localStorage.getItem('vasketid_user');
      const sp = localStorage.getItem('vasketid_pass');
      if (su) {
        u.value = su;
        if (su.toLowerCase() !== 'admin' && sp) {
          p.value = sp;
          chk.checked = true;
        }
      }

      // Gem ved submit
      form.addEventListener('submit', ()=>{
        const userLower = (u.value || '').toLowerCase();
        if (chk.checked) {
          localStorage.setItem('vasketid_user', u.value);
          if (userLower !== 'admin') {
            localStorage.setItem('vasketid_pass', p.value);
          } else {
            localStorage.removeItem('vasketid_pass');
          }
        } else {
          localStorage.removeItem('vasketid_user');
          localStorage.removeItem('vasketid_pass');
        }
      });

      // Ryd gemt kode når man skriver "admin"
      u.addEventListener('input', ()=>{
        if ((u.value || '').toLowerCase() === 'admin') {
          chk.checked = false;
          localStorage.removeItem('vasketid_pass');
        }
      });
    });
  </script>
</head>
<body>

  <!-- FROST-HVID FAST TOPPANEL -->
  <div class="toppanel toppanel--login" role="navigation" aria-label="Topbar">
  <div class="brand">Vasketider</div>

  <!-- Hamburger (SKAL have både 'hamburger' og 'right' classes) -->
  <button id="hamburgerBtn" class="hamburger right" type="button" aria-label="Åbn menu" onclick="toggleMenu()">
    <span class="hamburger-bar" aria-hidden="true"></span>
    <span class="hamburger-bar" aria-hidden="true"></span>
    <span class="hamburger-bar" aria-hidden="true"></span>
  </button>

  <!-- Fold-ud login-menu -->
  <div id="loginMenu" class="login-menu" role="menu" aria-label="Login-menu">
    <button type="button" class="toppanel-knap" onclick="submitLoginForm()">Log ind</button>
    <form method="get" action="/opret"><button type="submit" class="toppanel-knap">Opret ny bruger</button></form>
    <form method="get" action="/skiftkode"><button type="submit" class="toppanel-knap">Skift adgangskode</button></form>
    <form method="get" action="/regler"><button type="submit" class="toppanel-knap">Regler</button></form>
  </div>
</div>

  <!-- AUTH-VINDUE (kun login – opret/skift er flyttet i menuen) -->
  <div class="auth-wrap">
    <div class="auth-box">
      <h2>Log ind</h2>

      {% if fejl %}<p class="msg msg-error" role="alert">{{ fejl }}</p>{% endif %}
      {% if besked %}<p class="msg msg-ok">{{ besked }}</p>{% endif %}

      <form id="loginForm" method="post" action="/login" class="auth-form">
        <input type="text" id="brugernavn" name="brugernavn" placeholder="Brugernavn" required autocomplete="username">
        <input type="password" id="kode" name="kode" placeholder="Adgangskode" required autocomplete="current-password">

        <!-- Husk mig – samlet i én container og centreret -->
        <div class="remember-line">
          <label class="switch" title="Husk brugernavn og (ikke for admin) adgangskode på denne enhed">
            <input type="checkbox" id="huskMig" name="remember" value="1">
            <span class="slider round"></span>
          </label>
          <span class="remember-text">Husk mig</span>
        </div>

        <button type="submit" class="glass-btn">Log ind</button>
      </form>
    </div>
  </div>

  <!-- Social footer bevares -->
  <footer class="footer">
    <span class="footer-left">© Hornsberg Group</span>
    <ul class="socials">
      <li>
        <a href="https://linkedin.com" target="_blank" aria-label="LinkedIn">
          <span class="icon-wrap">
            <img src="{{ url_for('static', filename='icons/linkedin.svg') }}" alt="LinkedIn">
          </span>
        </a>
      </li>
      <li>
        <a href="https://facebook.com" target="_blank" aria-label="Facebook">
          <span class="icon-wrap">
            <img src="{{ url_for('static', filename='icons/facebook.svg') }}" alt="Facebook">
          </span>
        </a>
      </li>
      <li>
        <a href="https://instagram.com" target="_blank" aria-label="Instagram">
          <span class="icon-wrap">
            <img src="{{ url_for('static', filename='icons/instagram.svg') }}" alt="Instagram">
          </span>
        </a>
      </li>
    </ul>
  </footer>
</body>
</html>
