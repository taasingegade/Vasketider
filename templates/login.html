<!DOCTYPE html>
<html lang="da">
<head>
  <meta charset="UTF-8">
  <title>Login</title>
  <link rel="icon" type="image/x-icon" href="{{ url_for('static', filename='favicon.ico') }}">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="manifest" href="{{ url_for('static', filename='manifest.json') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
  <script>
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('{{ url_for("static", filename="service-worker.js") }}');
    }
  </script>
</head>
<body>

<header class="toppanel toppanel--login" role="banner">
  <div class="top-left">
    <button class="hamburger"
            id="loginHamburger"
            type="button"
            aria-label="Åbn menu"
            aria-controls="loginMenu"
            aria-expanded="false">
      <span class="hamburger-bar"></span>
      <span class="hamburger-bar"></span>
      <span class="hamburger-bar"></span>
    </button>
    <div class="brand"><a href="/">Vasketider</a></div>
  </div>

    <nav class="login-menu" id="loginMenu" role="menu" aria-hidden="true">
    <a href="/login"     class="toppanel-knap" role="menuitem">Log ind</a>
    <a href="/opret"     class="toppanel-knap" role="menuitem">Opret ny bruger</a>
    <a href="/skiftkode" class="toppanel-knap" role="menuitem">Skift adgangskode</a>
    <a href="/regler"    class="toppanel-knap" role="menuitem">Regler</a>
    <a href="/vilkaar"   class="toppanel-knap" role="menuitem">Brugervilkår</a>
  </nav>
</header>

  <div class="auth-wrap" role="main">
    <div class="auth-box">
      <h2>Log ind</h2>

      {% if fejl %}<p class="msg msg-error" role="alert">{{ fejl }}</p>{% endif %}
      {% if besked %}<p class="msg msg-ok">{{ besked }}</p>{% endif %}

      <form id="loginForm" method="post" action="/login" class="auth-form">
        <input type="text" id="brugernavn" name="brugernavn" placeholder="Brugernavn" required autocomplete="username">
        <input type="password" id="kode" name="kode" placeholder="Adgangskode" required autocomplete="current-password">

        <div class="remember-line">
          <label class="switch" title="Husk brugernavn og (ikke for admin) adgangskode på denne enhed">
            <input type="checkbox" id="huskMig" name="remember" value="1">
            <span class="slider round"></span>
          </label>
          <span class="remember-text">Husk mig</span>
        </div>

        <button type="submit" class="glass-btn">Log ind</button>
      </form>
    </div>
  </div>

  <footer class="footer">
    <span class="footer-left">Powered by © Hornsberg Group</span>
    <ul class="socials">
      <li>
        <a href="https://linkedin.com" target="_blank" aria-label="LinkedIn">
          <span class="icon-wrap">
            <img src="{{ url_for('static', filename='icons/linkedin.svg') }}" alt="LinkedIn">
          </span>
        </a>
      </li>
      <li>
        <a href="https://facebook.com" target="_blank" aria-label="Facebook">
          <span class="icon-wrap">
            <img src="{{ url_for('static', filename='icons/facebook.svg') }}" alt="Facebook">
          </span>
        </a>
      </li>
      <li>
        <a href="https://instagram.com" target="_blank" aria-label="Instagram">
          <span class="icon-wrap">
            <img src="{{ url_for('static', filename='icons/instagram.svg') }}" alt="Instagram">
          </span>
        </a>
      </li>
    </ul>
  </footer>

  <!-- FÆLLES menu-script -->
<script>
(function () {
  function attachOne(btn, menu, activeClass = 'active', showClass = 'show') {
    if (!btn || !menu) return;
    if (btn.dataset.bound === '1') return;     // undgå dobbelte handlers
    btn.dataset.bound = '1';

    const setOpen = (open) => {
      btn.classList.toggle(activeClass, open);
      menu.classList.toggle(showClass, open);
      btn.setAttribute('aria-expanded', open ? 'true' : 'false');
      menu.setAttribute('aria-hidden', open ? 'false' : 'true');
    };

    btn.addEventListener('click', (e) => {
      e.stopPropagation();
      setOpen(!menu.classList.contains(showClass));
    }, { passive: true });

    // klik udenfor => luk
    document.addEventListener('click', (e) => {
      if (!menu.contains(e.target) && !btn.contains(e.target)) setOpen(false);
    });

    // Esc => luk
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape') setOpen(false);
    });

    // initial ARIA
    btn.setAttribute('aria-expanded', 'false');
    menu.setAttribute('aria-hidden', 'true');
  }

  // Offentlig API (hvis du vil binde specifikt)
  function attach(opts = {}) {
    const buttonSel = opts.button || '#hamburger';
    const drawerSel = opts.drawer || '#topMenu';
    const active    = opts.activeClass || 'active';
    const show      = opts.showClass   || 'show';
    const btn  = document.querySelector(buttonSel);
    const menu = document.querySelector(drawerSel);
    attachOne(btn, menu, active, show);
    return { setOpen: (open) => attachOne(btn, menu, active, show) };
  }

  // Auto-bind ALLE hamburgere på siden, når DOM er klar
  function autoBindAll() {
    document.querySelectorAll('.hamburger[aria-controls]').forEach((btn) => {
      const id = btn.getAttribute('aria-controls');
      const menu = document.getElementById(id);
      attachOne(btn, menu);
    });
  }

  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', autoBindAll);
  } else {
    autoBindAll();
  }

  window.VasketiderMenu = { attach };
})();
</script>
<script>
  VasketiderMenu.attach({ button:'#loginHamburger', drawer:'#loginMenu' });
</script>
</body>
</html>