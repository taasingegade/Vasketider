<!DOCTYPE html>
<html lang="da">
<head>
  <meta charset="UTF-8">
  <title>Login</title>
  <link rel="icon" type="image/x-icon" href="{{ url_for('static', filename='favicon.ico') }}">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="manifest" href="{{ url_for('static', filename='manifest.json') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
  <script>
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('{{ url_for("static", filename="service-worker.js") }}');
    }
  </script>
</head>
<body>

  <header class="toppanel toppanel--login" role="banner">
    <div class="brand">Velkommen til Vasketider</div>

    <button class="hamburger right"
            id="loginHamburger"
            type="button"
            aria-label="Menu"
            aria-controls="loginMenu"
            aria-expanded="false">
      <span class="hamburger-bar"></span>
      <span class="hamburger-bar"></span>
      <span class="hamburger-bar"></span>
    </button>

    <nav class="login-menu" id="loginMenu" role="navigation" aria-label="Login menu">
      <a class="toppanel-knap" href="/login">Log ind</a>
      <a class="toppanel-knap" href="/opret">Opret ny bruger</a>
      <a class="toppanel-knap" href="/skiftkode">Skift adgangskode</a>
      <a class="toppanel-knap" href="/regler">Regler</a>
      <a class="toppanel-knap" href="/betingelser">Brugervilkår</a>
    </nav>
  </header>

  <div class="auth-wrap" role="main">
    <div class="auth-box">
      <h2>Log ind</h2>

      {% if fejl %}<p class="msg msg-error" role="alert">{{ fejl }}</p>{% endif %}
      {% if besked %}<p class="msg msg-ok">{{ besked }}</p>{% endif %}

      <form id="loginForm" method="post" action="/login" class="auth-form">
        <input type="text" id="brugernavn" name="brugernavn" placeholder="Brugernavn" required autocomplete="username">
        <input type="password" id="kode" name="kode" placeholder="Adgangskode" required autocomplete="current-password">

        <div class="remember-line">
          <label class="switch" title="Husk brugernavn og (ikke for admin) adgangskode på denne enhed">
            <input type="checkbox" id="huskMig" name="remember" value="1">
            <span class="slider round"></span>
          </label>
          <span class="remember-text">Husk mig</span>
        </div>

        <button type="submit" class="glass-btn">Log ind</button>
      </form>
    </div>
  </div>

  <footer class="footer">
    <span class="footer-left">Powered by © Hornsberg Group</span>
    <ul class="socials">
      <li>
        <a href="https://linkedin.com" target="_blank" aria-label="LinkedIn">
          <span class="icon-wrap">
            <img src="{{ url_for('static', filename='icons/linkedin.svg') }}" alt="LinkedIn">
          </span>
        </a>
      </li>
      <li>
        <a href="https://facebook.com" target="_blank" aria-label="Facebook">
          <span class="icon-wrap">
            <img src="{{ url_for('static', filename='icons/facebook.svg') }}" alt="Facebook">
          </span>
        </a>
      </li>
      <li>
        <a href="https://instagram.com" target="_blank" aria-label="Instagram">
          <span class="icon-wrap">
            <img src="{{ url_for('static', filename='icons/instagram.svg') }}" alt="Instagram">
          </span>
        </a>
      </li>
    </ul>
  </footer>

  <!-- FÆLLES menu-script -->
  {{ '' }}
  (se /static/js/menu.js ovenfor)
  {{ '' }}

  <!-- Slå toggling til for login -->
  <script>
    window.VasketiderMenu?.attach({
      button: '#loginHamburger',
      drawer: '#loginMenu'
    });

    // Husk-mig logik (som før), men uden at blande sig i menuen:
    document.addEventListener('DOMContentLoaded', ()=>{
      const form = document.getElementById('loginForm');
      const u = document.getElementById('brugernavn');
      const p = document.getElementById('kode');
      const chk = document.getElementById('huskMig');

      if (!form) return;

      form.addEventListener('keydown', (ev)=>{
        if (ev.key === 'Enter') { ev.preventDefault(); form.submit(); }
      });

      const su = localStorage.getItem('vasketid_user');
      const sp = localStorage.getItem('vasketid_pass');
      if (su) {
        u.value = su;
        if (su.toLowerCase() !== 'admin' && sp) {
          p.value = sp;
          chk.checked = true;
        }
      }

      form.addEventListener('submit', ()=>{
        const userLower = (u.value || '').toLowerCase();
        if (chk.checked) {
          localStorage.setItem('vasketid_user', u.value);
          if (userLower !== 'admin') {
            localStorage.setItem('vasketid_pass', p.value);
          } else {
            localStorage.removeItem('vasketid_pass');
          }
        } else {
          localStorage.removeItem('vasketid_user');
          localStorage.removeItem('vasketid_pass');
        }
      });

      u.addEventListener('input', ()=>{
        if ((u.value || '').toLowerCase() === 'admin') {
          chk.checked = false;
          localStorage.removeItem('vasketid_pass');
        }
      });
    });
  </script>
</body>
</html>