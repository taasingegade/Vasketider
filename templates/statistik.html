
<!DOCTYPE html>
<html lang="da">
<head>
  <meta charset="UTF-8">
  <title>Statistik</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
  <style>
    .statistik-flex {
      display: flex;
      flex-wrap: wrap;
      justify-content: space-between;
      gap: 30px;
    }
    .stat-col {
      flex: 1;
      min-width: 300px;
    }
    .diagram-container {
      text-align: center;
      margin-top: 40px;
    }
    .diagram-container img {
      max-width: 400px;
      width: 100%;
      height: auto;
      border-radius: 10px;
    }
  </style>
</head>
<body style="background: url('/static/Bg.jpg') no-repeat center center fixed; background-size: cover;">

  <!-- Toppanel -->
  <div class="toppanel">
    <form method="post" action="/logout">
      <button class="toppanel-knap">Log ud</button>
    </form>
    <form method="get" action="/admin">
      <button class="toppanel-knap">Tilbage til Admin</button>
    </form>
    <form method="get" action="/download_logins_pdf">
    <button type="submit">Download PDF</button>
    </form>
</div>

<div class="glassbox" style="max-width: 1000px; margin: 100px auto;">
  <h2>Statistik – Aktivitet & Loginforsøg</h2>

  <canvas id="bookingChart" style="max-width: 600px; margin: 20px auto;"></canvas>

  <div class="statistik-flex">
    <div class="stat-col">
      <h3>Bookinger</h3>
      {% for booking in bookinger %}
        <p>{{ booking.brugernavn }} har booket {{ booking.dato }} – {{ booking.tid }}</p>
      {% else %}
        <p>Ingen bookinger fundet.</p>
      {% endfor %}
    </div>

    <div class="stat-col">
      <h3>Loginforsøg</h3>
      {% for log in loginforsøg %}
        <p>
          <strong>{{ log.brugernavn }}</strong> – {{ log.tidspunkt }}
          <form method="post" action="/slet_loginforsøg" style="display:inline;">
            <input type="hidden" name="log_id" value="{{ log.id }}">
            <button type="submit">Slet</button>
          </form>
        </p>
      {% else %}
        <p>Ingen loginforsøg registreret.</p>
      {% endfor %}
    </div>
  </div>
</div>
  <!-- Indhold -->
  <div class="glassbox" style="max-width: 1000px; margin: 100px auto;">
    <h2>Statistik – Aktivitet & Loginforsøg</h2>

    <div class="statistik-flex">
      <!-- Venstre: Bookinger -->
      <div class="stat-col">
        <h3>Bookinger</h3>
        {% for booking in bookinger %}
          <p>{{ booking.brugernavn }} har booket {{ booking.dato }} – {{ booking.tid }}</p>
        {% else %}
          <p>Ingen bookinger fundet.</p>
        {% endfor %}
      </div>

      <!-- Højre: Loginforsøg -->
      <div class="stat-col">
        <h3>Loginforsøg</h3>
        <form method="get" action="/download_logins_pdf">
          <button type="submit">Download PDF</button>
        </form>
        <br>
        {% for log in loginforsøg %}
          <p>
            <strong>{{ log.brugernavn }}</strong> – {{ log.tidspunkt }}
            <form method="post" action="/slet_loginforsøg" style="display:inline;">
              <input type="hidden" name="log_id" value="{{ log.id }}">
              <button type="submit">Slet</button>
            </form>
          </p>
        {% else %}
          <p>Ingen loginforsøg registreret.</p>
        {% endfor %}
      </div>
    </div>

    <!-- Diagram -->
    <div class="diagram-container">
      <h3>Diagram: Bookingaktivitet</h3>
      <img src="{{ url_for('static', filename='booking_diagram.png') }}" alt="Booking diagram">
    </div>
  </div>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
fetch("/bookinger_json")
  .then(res => res.json())
  .then(data => {
    const grupperet = {};

    data.forEach(b => {
      if (!grupperet[b.dato]) grupperet[b.dato] = 0;
      grupperet[b.dato]++;
    });

    const labels = Object.keys(grupperet);
    const antal = Object.values(grupperet);

    new Chart(document.getElementById("bookingChart"), {
      type: "bar",
      data: {
        labels: labels,
        datasets: [{
          label: "Antal bookinger pr. dag",
          data: antal,
          backgroundColor: "rgba(54, 162, 235, 0.6)"
        }]
      },
      options: {
        scales: {
          x: { ticks: { maxRotation: 90, minRotation: 45 } },
          y: { beginAtZero: true }
        }
      }
    });
  });
</script>

  <footer>© Hornsberg Group</footer>
</body>
</html>